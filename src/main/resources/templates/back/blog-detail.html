<!DOCTYPE html>
<html class="x-admin-sm" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>博客详情</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0"/>
    <link rel="stylesheet" th:href="@{/static/back/css/font.css}">
    <link rel="stylesheet" th:href="@{/static/back/css/xadmin.css}">
    <script th:src="@{/static/back/lib/layui/layui.js}" charset="utf-8"></script>
    <script th:src="@{/static/back/js/xadmin.js}"></script>
    <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
    <!-- editor.md编辑器相关 -->
    <link rel="stylesheet" th:href="@{/static/fore/lib/editor.md-1.5.0/css/editormd.min.css}">
    <script th:src="@{/static/fore/lib/editor.md-1.5.0/editormd.min.js}"></script>
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!-- nav导航 -->
<div class="x-nav">
    <span class="layui-breadcrumb">
        <a href="javascript:">首页</a>
        <a href="javascript:">博客管理</a>
        <a href="javascript:"><cite>编辑</cite></a>
    </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right"
       onclick="location.reload()" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
    </a>
</div>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <form class="layui-form">
                    <div class="layui-card-body">
                        <div class="layui-collapse">
                            <div class="layui-colla-item">
                                <h2 class="layui-colla-title">博客属性<i class="layui-icon layui-colla-icon"></i></h2>
                                <div class="layui-colla-content">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">博客Id</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="id" autocomplete="off"
                                                   class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">博客标题</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="title" autocomplete="off"
                                                   class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">博客作者</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="author" autocomplete="off"
                                                   class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">博客类型</label>
                                        <div class="layui-input-block">
                                            <select name="type" lay-search id="type">
                                                <option value="">博客标签分类</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">博客简介</label>
                                        <div class="layui-input-block">
                                            <textarea name="summary" placeholder="请输入博客的简介"
                                                      class="layui-textarea"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-card-body">
                        <fieldset class="layui-elem-field layui-field-title site-title">
                            <legend><a name="default">博客内容</a></legend>
                        </fieldset>
                        <div id="blog-editormd">
                            <textarea style="display:none;"></textarea>
                        </div>
                    </div>
                    <div class="layui-card-body">
                        <div class="layui-form-item">
                            <div class="layui-input-block" style="margin-left: 0;">
                                <button type="reset" class="layui-btn layui-btn-fluid">重置</button>
                            </div>
                            <div class="layui-input-block" style="margin-left: 0;">
                                <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="blog">提交</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script th:inline="javascript">
    // 根据传递过来的Id属性渲染
    let blogId = [[${#request.getParameter("blogId")}]];
    console.log("blogId = " + blogId);
    // 初始化编辑框
    let blogEditor;
    blogEditor = editormd("blog-editormd", {
        width: "100%",
        height: 730,
        path: '/re/static/fore/lib/editor.md-1.5.0/lib/',
        codeFold: true,
        saveHTMLToTextarea: true,
        searchReplace: true,
        htmlDecode: "style,script,iframe|on*",
        emoji: true,
        taskList: true,
        theme: "dark",
        editorTheme: "rubyblue",
        previewTheme: "dark",
        tocm: true,         // Using [TOCM]
        tex: true,                   // 开启科学公式TeX语言支持，默认关闭
        flowChart: true,             // 开启流程图支持，默认关闭
        sequenceDiagram: true,       // 开启时序/序列图支持，默认关闭,
        imageUpload: true,
        imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
        imageUploadURL: "examples/php/upload.php",
        onload: function () {
            console.log('onload', this);
        }
    });

    layui.use(['form'], function () {
        let form = layui.form;
        // ajax请求获取文章数据
        $.ajax({
            url: [[${#servletContext.contextPath}]] + "/api/listBlogTypeAll",
            method: "GET",
            dataType: "json",
            success: function (res) {
                // 请求成功，将option拼接到下拉框中去
                if (res.request === "success" && res.status === 200) {
                    $.each(res.data, function (index, item) {
                        $('#type').append(new Option(item.name, item.id));
                    });
                    form.render();
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
        // 如果blogId存在，那么说明是修改，如果不存在那么说明是

        form.on('submit(blog)', function (data) {
            //被执行事件的元素DOM对象，一般为button对象
            console.log(data.elem);
            //被执行提交的form对象，一般在存在form标签时才会返回
            console.log(data.form);
            //当前容器的全部表单字段，名值对形式：{name: value}
            console.log(data.field);
            //阻止表单跳转。如果需要表单跳转，去掉这段即可。

            return false;
        });
    });
</script>
</body>
</html>